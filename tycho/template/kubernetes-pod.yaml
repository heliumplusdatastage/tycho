---
# Added volume mounts
# Generated by Tycho {{ now() }}
apiVersion: v1
kind: Pod
metadata:
  name: {{ name }}
  labels:
    name: {{ name }}
    executor: tycho
    tycho-guid: {{ system_id }}
spec:
  containers:
{% for container in containers %}    
  - name: {{ container.name }}
    image: {{ container.image }}
{% if container.command %}
    command: {{ container.command }}
{% endif %}
{% if container.env %}
    env:
    {%for e in container.env %}
    - name : {{ e[0] }}
      value : "{{ e[1] }}"
    {% endfor %}
{% endif %}
{% if container.ports %}     
    ports:
       - containerPort: {{ container.ports[0]['containerPort'] }}
         protocol: TCP
{% endif %} # ports
{% if container.limits or container.requests %}
    resources:
      {% if container.limits %}
      limits:
        cpu: "{{ container.limits.cpus }}"  
        memory: "{{ container.limits.memory }}"
      {% endif %}
      {% if container.requests %}
      requests:
        cpu: "{{ container.requests.cpus }}"
        memory: "{{ container.requests.memory }}"
      {% endif %}
{% endif %}
    volumeMounts:
{% if container.volumes %}
{% for volume in container.volumes %}
      - name: {{ name }}-{{ loop.index }}
        mountPath: {{ volume }}
        readOnly: false
     {% endfor %}
  volumes:
{% for volume in container.volumes %}
    - name: {{ name }}-{{ loop.index }}
      persistentVolumeClaim:
        claimName: pvc-for-{{ name }}-{{ loop.index }}     
     {% endfor %}
     {% endif %}
{% endfor %}
